{
  "patch": "Analytics Expansion v5.2",
  "description": "Deep analytics + export + visual upgrades. Canon v4.1 safe.",
  "requires": { "canon": "v4.1", "architect": "v6.1" },
  "modules": [
    {
      "id": "M170",
      "name": "Shot Quality & Danger Engine",
      "enabled": true,
      "inputs": { "source": "sim_reports/*, elite/xg_stream.json" },
      "outputs": { "file": "analytics/xg_shot_quality_lastN.json" },
      "config": { "window_games": 10, "bucket_scheme": "low,med,high,royalRd" }
    },
    {
      "id": "M171",
      "name": "Zone Entry/Exit Tracker",
      "enabled": true,
      "inputs": { "telemetry": "dynasty_vision_ui/telemetry.json" },
      "outputs": { "file": "analytics/entries_exits_lastN.json" },
      "config": { "window_games": 10, "trackers": ["carry","chip","dump","clean_exit","failed_exit"] }
    },
    {
      "id": "M172",
      "name": "Goalie xSV Model 2.0",
      "enabled": true,
      "inputs": { "shots": "analytics/xg_shot_quality_lastN.json", "goalies": "LeafsAI/GoaliePlan/*.json" },
      "outputs": { "file": "analytics/goalie_xsv_model.json" },
      "config": { "normalize_weather": true, "min_shots": 75 }
    },
    {
      "id": "M173",
      "name": "PP/PK Micro-Tendencies",
      "enabled": true,
      "inputs": { "special": "sim_reports/special_teams_lastN.json" },
      "outputs": { "file": "analytics/pp_pk_micro.json" },
      "config": { "rotation_every_games": 10, "pp_variants": ["Umbrella","Overload"], "pk_variants": ["Diamond","Passive Box"] }
    },
    {
      "id": "M174",
      "name": "Bench Event Timeline",
      "enabled": true,
      "inputs": { "bench": "dynasty_vision_ui/bench_events.json" },
      "outputs": { "file": "analytics/bench_timeline_last_game.json" }
    },
    {
      "id": "M175",
      "name": "Analytics Report Generator v2",
      "enabled": true,
      "inputs": {
        "xg": "analytics/xg_shot_quality_lastN.json",
        "entries": "analytics/entries_exits_lastN.json",
        "goalie": "analytics/goalie_xsv_model.json",
        "special": "analytics/pp_pk_micro.json"
      },
      "outputs": { "pdf": "reports/Analytics_Report_v5.2_Last10.pdf" },
      "config": { "theme": "dynasty_dark", "include_overlays": ["heat_trap","injury_heatmap","discipline_heatmap"] }
    },
    {
      "id": "M176",
      "name": "CSV/Sheets Export Bridge",
      "enabled": true,
      "inputs": {
        "summary": "reports/Analytics_Report_v5.2_Last10.pdf",
        "tables": ["analytics/xg_shot_quality_lastN.json","analytics/entries_exits_lastN.json","analytics/pp_pk_micro.json"]
      },
      "outputs": { "zip": "exports/analytics_last10_csv.zip" },
      "config": { "csv": true, "schema_version": "5.2" }
    }
  ],
  "automation": {
    "post_game_pipeline": [
      "update_xg_engine (M170)",
      "update_entries_exits (M171)",
      "update_goalie_xsv (M172)",
      "update_pp_pk (M173)",
      "generate_report_v2 (M175)",
      "export_csv (M176)"
    ]
  },
  "git": {
    "tag": "v5.2-AnalyticsExpansion",
    "commit_message": "feat(analytics): v5.2 expansion (M170–M176) — shot quality, entries/exits, goalie xSV, PP/PK micro, report v2, CSV export"
  },
  "post_install_commands": [
    "/verify_patch",
    "/analytics_report --range last_10 --modules \"xg,entries,goalie,pp_pk\"",
    "/enable_overlay \"discipline_heatmap\" --source M161 --link \"dynasty_vision_ui\""
  ]
}