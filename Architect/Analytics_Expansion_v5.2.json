{
  "patch": "Analytics Expansion v5.2",
  "description": "Deepens RealChem/Momentum/Dynasty Vision telemetry: shift-level xG, shot origins, entry tracking, goalie rebound xG, faceoff maps. Canon-safe.",
  "requires": {
    "canon": "v4.1",
    "architect": "v6.1",
    "compat": ["Elite_Convergence_v5.0", "GamePlanner_v5.1", "SystemIntel_v5.1", "Stability_Kernel_v3.0"]
  },
  "create_dirs": [
    "analytics",
    "analytics/live",
    "analytics/reports",
    "analytics/archive",
    "overlays"
  ],
  "modules": [
    {
      "id": "M170",
      "name": "Shift-Level xG Engine",
      "enabled": true,
      "inputs": {
        "source": "dynasty_vision_core",
        "chemistry": "elite/chemistry_latest.json"
      },
      "config": {
        "rolling_window_games": 10,
        "export_every_period": true
      },
      "output": "analytics/live/shift_xg_stream.json"
    },
    {
      "id": "M171",
      "name": "Shot-Origin & Danger Map",
      "enabled": true,
      "inputs": { "source": "dynasty_vision_core" },
      "config": { "bin_size_ft": 5, "danger_model": "hd_v3" },
      "output": "analytics/live/shot_danger_map.json"
    },
    {
      "id": "M172",
      "name": "Entry/Exit Tracker (PP/PK aware)",
      "enabled": true,
      "inputs": { "source": "gameplanner_scout" },
      "config": {
        "track": ["controlled_entries", "dump_ins", "clean_exits", "failed_exits"],
        "special_teams": true
      },
      "output": "analytics/live/entries_exits.json"
    },
    {
      "id": "M173",
      "name": "Goalie Rebound xG & Heat",
      "enabled": true,
      "inputs": { "source": "dynasty_vision_core" },
      "config": { "rebound_window_s": 3.0, "low_blocker_bias": true },
      "output": "analytics/live/rebound_xg.json"
    },
    {
      "id": "M174",
      "name": "Faceoff Outcome Mapper",
      "enabled": true,
      "inputs": { "source": "dynasty_vision_core" },
      "config": { "zones": ["OZ","NZ","DZ"], "handedness_factor": true },
      "output": "analytics/live/faceoff_map.json"
    },
    {
      "id": "M175",
      "name": "Rush vs Cycle Attribution",
      "enabled": true,
      "inputs": { "source": "dynasty_vision_core" },
      "config": { "rush_time_s": 6, "cycle_time_s": 12 },
      "output": "analytics/live/rush_cycle_split.json"
    },
    {
      "id": "M176",
      "name": "PP Entry Book (Blue-to-Blue vs Three-High)",
      "enabled": true,
      "inputs": { "source": "special_teams_optimizer" },
      "config": { "aggregate_every": "game" },
      "output": "analytics/live/pp_entry_book.json"
    },
    {
      "id": "M177",
      "name": "Dynasty Vision Layer: Analytics Suite",
      "enabled": true,
      "overlays": [
        {"id":"xg_shotmap","source":"analytics/live/shot_danger_map.json"},
        {"id":"entries_exits","source":"analytics/live/entries_exits.json"},
        {"id":"rebound_risk","source":"analytics/live/rebound_xg.json"},
        {"id":"faceoff_heat","source":"analytics/live/faceoff_map.json"},
        {"id":"rush_cycle","source":"analytics/live/rush_cycle_split.json"}
      ],
      "output": "overlays/analytics_suite_layers.json"
    }
  ],
  "automation": {
    "post_game_pipeline": [
      "analytics_update",
      "chemistry_refresh",
      "snapshot_auto_save",
      "export_reports"
    ],
    "exports": [
      {
        "name": "Performance_Pulse_Summary",
        "source": [
          "analytics/live/shift_xg_stream.json",
          "analytics/live/shot_danger_map.json",
          "analytics/live/entries_exits.json",
          "analytics/live/rebound_xg.json",
          "analytics/live/faceoff_map.json",
          "analytics/live/rush_cycle_split.json"
        ],
        "target": "analytics/reports/Performance_Pulse_Summary_latest.json",
        "archive": "analytics/archive/Performance_Pulse_Summary_${date}.json"
      }
    ]
  },
  "git": {
    "tag": "v5.2-AnalyticsExpansion",
    "commit_message": "feat(analytics): v5.2 expansion â€” shift-level xG, shot danger, entries/exits, rebound xG, FO maps, rush/cycle; overlays wired to Dynasty Vision"
  },
  "post_install_commands": [
    "/verify_patch",
    "/enable_overlay \"xg_shotmap\" --source overlays/analytics_suite_layers.json",
    "/enable_overlay \"entries_exits\" --source overlays/analytics_suite_layers.json",
    "/enable_overlay \"rebound_risk\" --source overlays/analytics_suite_layers.json",
    "/enable_overlay \"faceoff_heat\" --source overlays/analytics_suite_layers.json",
    "/enable_overlay \"rush_cycle\" --source overlays/analytics_suite_layers.json",
    "/qa_weekly --tasks \"analytics_latency_check, overlay_sync_check, rebound_bias_verify\""
  ]
}